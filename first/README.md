Изображения обрабатываются в том же thread что и голосовые чтобы не терять контекст разговора. Перешла с модельки  gpt-4 на 4o т.к. просто 4 не поддерживала обработку изображений 

TreadPoolExecutor вынесен через декоратор. Реакция на события трех видов: на изображения записывает ответ из определения настроения, на голосовое 1) если найдена ценность она сохраняется в табличку а до этого отправляется в event, 2) после всего записывается вопрос пользователя и ответ ассистента.

Кстати когда делала свой ключ для amplitude так и не поняла как подключить европейский ключ, вроде кидала параметр  server_zone="EU"(Amplitude("api_key", server_zone="EU")), но что то не сработало хотя вроде в конфигах библиотеки такое поле есть.